(function() {
bundle_data_sv = {};

bundle_data_sv.node_size_detail = 6503523;
bundle_data_sv.node_size_thumb = 13697687;
bundle_data_sv.node_size_select = 5000000;

bundle_data_sv.item_num = 83;

// sorted by index
bundle_data_sv.index_ID = [
'SAMPLE0',
'SAMPLE1',
'SAMPLE2',
'SAMPLE3',
'SAMPLE4',
'SAMPLE5',
'SAMPLE6',
'SAMPLE7',
'SAMPLE8',
'SAMPLE9'
];

bundle_data_sv.genome_size = [
{"chr":"00", "size":249250621},
{"chr":"01", "size":243199373},
{"chr":"02", "size":198022430},
{"chr":"03", "size":191154276},
{"chr":"04", "size":180915260},
{"chr":"05", "size":171115067},
{"chr":"06", "size":159138663},
{"chr":"07", "size":146364022},
{"chr":"08", "size":141213431},
{"chr":"09", "size":135534747},
{"chr":"10", "size":135006516},
{"chr":"11", "size":133851895},
{"chr":"12", "size":115169878},
{"chr":"13", "size":107349540},
{"chr":"14", "size":102531392},
{"chr":"15", "size":90354753},
{"chr":"16", "size":81195210},
{"chr":"17", "size":78077248},
{"chr":"18", "size":59128983},
{"chr":"19", "size":63025520},
{"chr":"20", "size":48129895},
{"chr":"21", "size":51304566},
{"chr":"22", "size":155270560},
{"chr":"23", "size":59373566}
];

// 0:ID, 1:chr1, 2:break1, 3:direction1, 4:gene_name1, 5:chr2, 6:break2, 7:direction2, 8:gene_name2, 9:type, 10:is_inter, 11:is_snippet
bundle_data_sv.links = [
["SAMPLE7","11",5808948,"+","DHHTZS0BXA","00",126650799,"+","9R3ZGE3IXH","inversion",false,false],
["SAMPLE7","22",62416825,"-","7AX4FKAKAK","08",103363021,"+","HF1ETI110G","deletion",false,false],
["SAMPLE7","21",49569332,"-","ZJGH7LM6AV","10",43957639,"-","9L8Z8B3IMV","tandem_duplication",false,false],
["SAMPLE7","17",33987824,"+","8XM6N804SW","08",20235198,"-","AX3PXI48GR","tandem_duplication",false,false],
["SAMPLE7","11",82038786,"+","S129U3CYCM","03",188188728,"-","8YJYOLTITN","deletion",false,false],
["SAMPLE7","00",238731382,"+","XLUN7MJTAJ","04",147513508,"+","GN5Z3BYX2X","tandem_duplication",false,false],
["SAMPLE7","18",30665368,"-","GK7YOHPRXS","14",88366003,"-","CT1IP0EUVH","deletion",false,false],
["SAMPLE7","13",82447532,"-","496U6Z0SVN","20",15166596,"-","MURBDM2A6G","deletion",false,false],
["SAMPLE7","20",17082231,"-","CO9P7G1IGG","19",15076736,"-","14AI31M02V","inversion",false,false],
["SAMPLE7","00",139050751,"+","CAWBGB2XGN","18",17400358,"+","OPGCA72Z00","inversion",false,false],
["SAMPLE4","05",170379443,"-","LEEM78T94A","16",80831681,"-","7XL15GMBTG","deletion",false,false],
["SAMPLE4","08",1133301,"-","AUGJHPYY5R","06",134732389,"+","XVL9G2Y5X9","tandem_duplication",false,false],
["SAMPLE4","07",77149226,"+","H0Y20DBD1E","15",26753461,"-","5NKT2ASPG3","tandem_duplication",false,false],
["SAMPLE4","06",16278731,"+","93AESRZLEE","09",83172731,"-","YZ6WS39WMB","translocation",false,false],
["SAMPLE4","10",83471004,"+","L7M0UDTPQ5","13",85966489,"+","M4DTGT0ML5","inversion",false,false],
["SAMPLE4","04",20810285,"+","71MB9E5TTO","21",7340004,"+","JAUV7W6UKT","tandem_duplication",false,false],
["SAMPLE4","06",150114646,"+","NSOMTTCSG2","23",3930914,"-","QM0BXA34DC","translocation",false,false],
["SAMPLE0","13",16019088,"-","LS7T1EG444","11",62784483,"+","4GRRIO5AVR","deletion",false,false],
["SAMPLE0","08",99412502,"-","FQFW16UF5U","06",129302434,"+","QP779MLPNV","translocation",false,false],
["SAMPLE0","12",84663781,"+","Q9VX1I9U3I","17",52991509,"-","7XM09ETN40","deletion",false,false],
["SAMPLE0","00",153160367,"+","CEE2SPV1R1","21",33751554,"+","PVYYQIVS8G","inversion",false,false],
["SAMPLE0","17",12249358,"-","HH9OL7CK6G","02",146222593,"+","XD80LI4E6Q","translocation",false,false],
["SAMPLE0","20",8658030,"+","I20EVP15ZM","22",133492043,"-","WPE8O5H237","tandem_duplication",false,false],
["SAMPLE0","11",120178477,"+","IMYXD3TCA4","00",155354923,"-","3MNN5J0MDN","deletion",false,false],
["SAMPLE5","20",3692977,"-","RV1LGQXB9D","20",44510875,"+","7SBB6O5SCF","tandem_duplication",true,false],
["SAMPLE5","17",17920148,"+","TNFICY6HOP","22",144608009,"+","FLPJ3LKYEK","inversion",false,false],
["SAMPLE5","03",149672094,"+","FU23DJ4Q20","02",185716105,"+","MLKJP6DHMF","inversion",false,false],
["SAMPLE5","14",30455273,"-","SHU259UCN0","01",78238193,"-","ERQ3B751EJ","translocation",false,false],
["SAMPLE5","17",31707099,"+","3BBXNLV4L0","01",187464066,"-","2KCD4ABQKF","deletion",false,false],
["SAMPLE5","22",13113310,"-","EJWJPOI28R","21",22014231,"-","8TCTGP98KC","tandem_duplication",false,false],
["SAMPLE5","07",43600568,"-","CLQE7SHAC0","10",4511056,"-","ZAR4QCMZQC","deletion",false,false],
["SAMPLE5","06",121989817,"+","X0ACLQM3T6","07",145405637,"+","Y3ZK0NSAAI","translocation",false,false],
["SAMPLE5","15",67070418,"+","2PL9Y1IHDT","02",1508171,"+","K5OMKPB6X1","translocation",false,false],
["SAMPLE5","00",244043779,"+","80UBEXTRIK","00",71692260,"+","EGRJWCKCR4","tandem_duplication",true,false],
["SAMPLE1","10",101374238,"+","FZ7LOS66RD","21",26701405,"+","9WYBJR57E0","translocation",false,false],
["SAMPLE1","01",121708638,"-","5655M5E46B","06",137424167,"-","HB14VJXDHV","translocation",false,false],
["SAMPLE1","15",43027789,"+","REFSIL0H2M","21",23791492,"-","L5EA31R8U0","inversion",false,false],
["SAMPLE1","18",3862589,"-","1IRWHVZLH8","15",37135239,"+","6FUR9YMZOH","deletion",false,false],
["SAMPLE1","19",50294222,"+","DOH5G0YRQ9","00",164250235,"-","9TWYMR5CZ2","inversion",false,false],
["SAMPLE1","22",67392415,"+","EM36MRX9B3","14",3327412,"+","G4FPLN527D","translocation",false,false],
["SAMPLE8","06",95490728,"+","FYDK568GIN","08",89410590,"-","UJX2LBYPRZ","deletion",false,false],
["SAMPLE8","09",21675120,"+","WEK2P6N7A8","23",27300286,"+","GO8C5MYWF9","tandem_duplication",false,false],
["SAMPLE8","01",172625375,"+","RIYAPG7Y85","02",140646175,"-","EMJPDIYB8B","inversion",false,false],
["SAMPLE8","08",1853842,"-","IEOOJSNII2","17",59233042,"-","H52A5JY270","deletion",false,false],
["SAMPLE8","08",54636902,"+","1UWZ33GM3B","13",55352858,"+","MKR4ZN37FR","translocation",false,false],
["SAMPLE8","07",21951154,"-","MHS14HPP3R","06",54405063,"-","X0EYXQTYU2","translocation",false,false],
["SAMPLE8","14",42446898,"-","UNHE56HB00","19",9996637,"-","ATU9W7QOBH","tandem_duplication",false,false],
["SAMPLE8","00",8928882,"-","LH7ZVFY9KG","23",33387475,"+","NGMDE51OG3","inversion",false,false],
["SAMPLE8","15",32688406,"-","QIS13ZEE2H","07",77568655,"+","SCZE01KD0Z","inversion",false,false],
["SAMPLE8","05",103119146,"-","ZPU0C5WVUB","05",939420,"-","F6JNF1FF11","deletion",true,false],
["SAMPLE8","18",14532685,"+","YB2O0CHDU4","09",6879161,"+","4PSGVQVNXP","deletion",false,false],
["SAMPLE3","07",135644313,"-","UGR3O3UQS3","02",116748248,"-","SOA8DC1SVF","translocation",false,false],
["SAMPLE3","06",6037836,"-","KEHLYR1QQS","20",34855497,"-","F5J3QLOZ5I","inversion",false,false],
["SAMPLE3","06",109724564,"+","FUJKDGDW5K","13",106387943,"-","E44HKKEN06","tandem_duplication",false,false],
["SAMPLE3","21",21329746,"+","Z3JQJDLZ5Q","18",49132777,"-","T456SI8NFE","tandem_duplication",false,false],
["SAMPLE3","09",79484145,"+","BEW4LC26A9","21",48499740,"-","U985JNNU2W","translocation",false,false],
["SAMPLE3","10",122930352,"+","46NNN0OFRV","21",22765050,"-","JPUS6N5749","deletion",false,false],
["SAMPLE3","23",30102935,"+","WX0R8IGEK7","16",20945220,"-","EUAXA4NFHN","translocation",false,false],
["SAMPLE3","06",88998071,"-","523QAD1C8I","06",88999025,"+","523QAD1C8I","inversion",true,true],
["SAMPLE3","06",134692916,"-","QVH5C6GNQK","05",59279632,"-","LUJESA5CAC","tandem_duplication",false,false],
["SAMPLE3","03",18658364,"-","76CX2VBN92","03",18658859,"-","76CX2VBN92","deletion",true,false],
["SAMPLE3","05",58073561,"+","XQY7GCETVS","06",113049570,"-","PHN2WTGOLS","inversion",false,false],
["SAMPLE3","21",12753561,"+","OWWS9EYKPA","09",93983219,"-","7LYZCPRWQE","tandem_duplication",false,false],
["SAMPLE3","09",127888623,"-","1V92D2XBKB","09",127889381,"-","1V92D2XBKB","tandem_duplication",true,false],
["SAMPLE9","05",22883110,"+","RE9I9P9P2B","12",103743864,"-","P0L7N6I28J","inversion",false,false],
["SAMPLE9","03",170386551,"-","7HK6HBA03P","09",18115326,"-","B2I9RFL1QS","translocation",false,false],
["SAMPLE9","12",1987292,"-","20LWDLGBW9","15",30986341,"-","ZP6CM7GTIZ","tandem_duplication",false,false],
["SAMPLE9","14",98927733,"+","F7RNE23QBU","19",45592948,"+","UXHC93P2H6","translocation",false,false],
["SAMPLE9","09",23863882,"+","GEEUZIZ38F","04",171994772,"+","ATLMZ8104J","inversion",false,false],
["SAMPLE9","22",38494022,"+","FCB5OOKVCS","07",41894232,"-","LOFLF6ZT3A","translocation",false,false],
["SAMPLE9","13",72225317,"+","ELNV107ABY","12",80044106,"-","JRKN4SU57O","tandem_duplication",false,false],
["SAMPLE9","11",40058944,"+","PAJPAEH2O7","00",248492226,"-","X3ZE2O929G","deletion",false,false],
["SAMPLE9","22",14558186,"-","6SRCV24HTA","14",22615302,"-","W9F9D9M11L","inversion",false,false],
["SAMPLE9","09",59857362,"+","GG53SLDQZQ","07",15918102,"-","EX3SWZNHFF","tandem_duplication",false,false],
["SAMPLE6","12",108406515,"-","D4MV8CVUMH","03",103771354,"-","7GO6H15CL3","tandem_duplication",false,false],
["SAMPLE6","00",192482367,"-","GBSS53RWD7","16",39548764,"-","7GFQ9EX33K","tandem_duplication",false,false],
["SAMPLE6","18",24395717,"-","G9R6FMQ0UX","02",10876086,"-","40ZZ3JOOCL","tandem_duplication",false,false],
["SAMPLE6","03",174399989,"+","P0AFN2SI82","19",59075611,"+","XO7PGNX7TR","inversion",false,false],
["SAMPLE6","06",7433935,"-","FI152UQ37C","10",28020133,"-","89X8VFQJCD","inversion",false,false],
["SAMPLE6","06",30987719,"+","1JIJ86YDS3","14",31607367,"+","CL4XGDKUG0","tandem_duplication",false,false],
["SAMPLE2","21",34268355,"+","9SVRQCFVCO","09",19871820,"+","2BEWSO91FZ","tandem_duplication",false,false],
["SAMPLE2","01",51849987,"-","9HK7LTVZST","19",47304716,"+","DNCS44WCW0","inversion",false,false],
["SAMPLE2","05",66742149,"-","TJJCWQ6K6J","05",31916435,"+","V5X8Y5QHVS","translocation",true,false]
];

var node_name = function(Chr, index, leveling) {
    if (leveling == null) {
        leveling = false;
    }
    var ret;
    if (leveling == true) {
        ret = "root." + Chr + "." + Chr + "_" + ("000" + index).substr(-4);
    }
    else {
        ret = Chr + "_" + ("000" + index).substr(-4);
    }
    return ret;
};

var create_blank_nodes = function(node_size, leveling) {
    if (leveling == null) {
        leveling = false;
    }
    var nodes = [];
    for (var i = 0; i < bundle_data_sv.genome_size.length; i++){
        var item_num = Math.floor(bundle_data_sv.genome_size[i].size/node_size) + 1;
        if (leveling == false) {
            item_num = item_num + 1;
        }
        for (var j = 0; j < item_num; j++){
            var start;
            if (leveling == true) {
                start = node_name(bundle_data_sv.genome_size[i].chr, j, true);
            }
            else {
                start = node_name(bundle_data_sv.genome_size[i].chr, j, false);
            }
            nodes.push({"start":start, "ends":[], "tooltip":[]});
        }
    }
    return nodes
};

var create_bundle_dataset = function (ID, node_size, tooltip) {

    var dataset_outer = create_blank_nodes(node_size);
    var dataset_inner = create_blank_nodes(node_size);
    var dataset_snipp = create_blank_nodes(node_size);
    
    for (var i = 0; i < bundle_data_sv.links.length; i++) {
        if (bundle_data_sv.links[i][0] != ID) {
            continue;
        }
        
        var start = node_name(bundle_data_sv.links[i][1], Math.floor(bundle_data_sv.links[i][2]/node_size));
        var index = -1;
        for (var j = 0; j < dataset_outer.length; j++){
            if (dataset_outer[j].start == start) {
                index = j;
                break;
            }
        }
        if (index < 0) {
            continue;
        }
        var end_pos = Math.floor(bundle_data_sv.links[i][6]/node_size);
        var end = node_name(bundle_data_sv.links[i][5], end_pos);
        // if same position, sift end position.
        if (start == end) {
            if (end_pos == Math.floor(bundle_data_sv.genome_size[Number(bundle_data_sv.links[i][5])].size/node_size)) {
                end = node_name(bundle_data_sv.links[i][5], end_pos - 1);
            }
            else {
                end = node_name(bundle_data_sv.links[i][5], end_pos + 1);
            }
        }
        
        // link type
        if (bundle_data_sv.links[i][11] == true) {
            // snippet
            dataset_snipp[index].ends.push(end);
        }
        else if(bundle_data_sv.links[i][10] == true) {
            // inner
            dataset_inner[index].ends.push(end);
        }
        else {
            // outer
            dataset_outer[index].ends.push(end);
        }
        
        // tooltip
        if (tooltip == true) {
            // Chr1 and breakpoint1
            var must1 = "[" + style_sv_detail.arc_label_text[Number(bundle_data_sv.links[i][1])] + "] " + bundle_data_sv.links[i][2].toLocaleString();
            // Chr2 and breakpoint2
            var must2 = "; [" + style_sv_detail.arc_label_text[Number(bundle_data_sv.links[i][5])] + "] " + bundle_data_sv.links[i][6].toLocaleString();
            
            // direction1
            var dir1 = "";
            if (bundle_data_sv.links[i][3].length > 0) {
                dir1 = " (" + bundle_data_sv.links[i][3] + ")";
            }
            // direction2
            var dir2 = "";
            if (bundle_data_sv.links[i][7].length > 0) {
                dir2 = " (" + bundle_data_sv.links[i][7] + ")";
            }
            
            // gene name 1
            var name1 = "";
            if (bundle_data_sv.links[i][4].length > 0) {
                name1 = " " + bundle_data_sv.links[i][4];
            }
            // gene name 2
            var name2 = "";
            if (bundle_data_sv.links[i][8].length > 0) {
                name2 = " " + bundle_data_sv.links[i][8];
            }
            
            // type
            var sv_type = "";
            if (bundle_data_sv.links[i][9].length > 0) {
                sv_type = "; " + bundle_data_sv.links[i][9];
            }
            
            var tooltip_txt = must1 + dir1 + name1 + must2 + dir2 + name2 + sv_type

            if (bundle_data_sv.links[i][11] == true) {
                // snippet
                dataset_snipp[index].tooltip.push(tooltip_txt);
            }
            else if(bundle_data_sv.links[i][10] == true) {
                // inner
                dataset_inner[index].tooltip.push(tooltip_txt);
            }
            else {
                // outer
                dataset_outer[index].tooltip.push(tooltip_txt);
            }
        }
    }
    
    ret = [];
    ret.push(dataset_outer);
    ret.push(dataset_inner);
    ret.push(dataset_snipp);
    return ret;
};

bundle_data_sv.get_data_thumb = function (ID) {
    return create_bundle_dataset(ID, bundle_data_sv.node_size_thumb, false);
};

bundle_data_sv.get_arc_data_thumb = function () {
    return create_blank_nodes(bundle_data_sv.node_size_thumb, true);
};

bundle_data_sv.get_data_detail = function (ID) {
    return create_bundle_dataset(ID, bundle_data_sv.node_size_detail, true);
};

bundle_data_sv.get_arc_data_detail = function (ID) {
    return create_blank_nodes(bundle_data_sv.node_size_detail, true);
};

var key_to_index = function (list, key) {
    
    for (var i = 0; i < list.length; i++) {
        if (list[i] == key) {
            return i
        }
    }
    return -1;
};

bundle_data_sv.get_select = function () {
    var node_size = bundle_data_sv.node_size_select;
    var dataset = {"key":[], "item":[[],[],[]], "value":[[],[],[]]};
    
    var c = 0;
    for (var i = 0; i < bundle_data_sv.genome_size.length; i++){
        var item_num = Math.floor(bundle_data_sv.genome_size[i].size/node_size) + 1;
        for (var j = 0; j < item_num; j++){
            var key = node_name(bundle_data_sv.genome_size[i].chr, j, true);
            dataset.key[c] = key;
            dataset.item[0][c] = [];  // outer
            dataset.item[1][c] = [];  // inner
            dataset.item[2][c] = [];  // snippet
            dataset.value[0][c] = 0;  // outer
            dataset.value[1][c] = 0;  // inner
            dataset.value[2][c] = 0;  // snippet
            c++;
        }
    }
    for (var i = 0; i < bundle_data_sv.links.length; i++) {
        
        var key = node_name(bundle_data_sv.links[i][1], Math.floor(bundle_data_sv.links[i][2]/node_size), true);
        var item = node_name(bundle_data_sv.links[i][5], Math.floor(bundle_data_sv.links[i][6]/node_size), true);
        
        var idx1 = key_to_index(dataset.key, key);
        var idx2 = key_to_index(dataset.key, item);

        if ((idx1 < 0) || (idx2 < 0)) {
            continue;
        }
        // snippet
        if (bundle_data_sv.links[i][11] == true) {
            // add bp1
            dataset.item[2][idx1].push(bundle_data_sv.links[i][0]);
            
            // add bp2
            dataset.item[2][idx2].push(bundle_data_sv.links[i][0]);
        }
        // outer
        else if (bundle_data_sv.links[i][10] == false) {
            // add bp1
            dataset.item[0][idx1].push(bundle_data_sv.links[i][0]);
        
            // add bp2
            dataset.item[0][idx2].push(bundle_data_sv.links[i][0]);
        }
        // inner
        else {
            // add bp1
            dataset.item[1][idx1].push(bundle_data_sv.links[i][0]);
            // add bp2
            if (key != item) {
                dataset.item[1][idx2].push(bundle_data_sv.links[i][0]);
            }
        }
    }

   
     for (var i = 0; i < dataset.key.length; i++) {
        for (var j = 0; j < 3; j++) {
            if (dataset.item[j][i].length == 0) {
                continue;
            }
            // delete duplication
            var sort = dataset.item[j][i].filter(function (x, y, self) {
                return self.indexOf(x) === y;
             });
            dataset.item[j][i] = sort;
            dataset.value[j][i] = dataset.item[j][i].length;
        }
    }
    
    return dataset;
};
})();

