(function() {
sig_data = {};

sig_data.tooltip_format = {
    signature_title:{format:[[{label:'{sig}',type:'str',keys:['sig',],ext:''},],], keys: '{sig} '},
    signature_partial:{format:[[{label:'{route}',type:'str',keys:['route',],ext:''},{label:': ',type:'fix',keys:[],ext:''},{label:'{#sum_item_value}',type:'numeric',keys:['#sum_item_value',],ext:'6.2'},],], keys: '{#sum_item_value} {route} '},
    mutation_title:{format:[[{label:'{id}',type:'str',keys:['id',],ext:''},],], keys: '{id} '},
    mutation_partial:{format:[[{label:'{sig}',type:'str',keys:['sig',],ext:''},{label:': ',type:'fix',keys:[],ext:''},{label:'{#sum_item_value}',type:'numeric',keys:['#sum_item_value',],ext:'.2'},],], keys: '{#sum_item_value} {sig} '},
};

sig_data.signatures = ['signature 1','signature 2','signature 3',];
sig_data.sig_colors = ['#f39700','#6cbb5a','#e60012',];
sig_data.dataset_sig = [[[2209.5523,1028.5042,0,0,2893.2577,10082.7897,4501.0642,9653.167,3603.0659,1462.5369,1941.0086,3390.2625,925.4259,809.7883,329.5324,2899.7492],[0.0073,625.1018,17.3939,1012.5157,724.53,1153.11,4926.7038,0,1003.5146,1894.0611,0,24.6092,0,897.6326,1738.8494,1304.9101],[8566.159,8546.3657,223826.2268,7279.1446,2354.828,7356.9917,170083.7605,4399.8752,37425.3468,25694.47,222735.9391,17289.9571,3227.8939,4271.1139,90179.2395,1880.7925],[2366.7996,1709.4881,2082.9872,0,0,1069.9548,1995.4645,498.9629,0,1091.409,0,0,0,569.8041,0,0],[2158.4899,2023.5163,8239.1583,0,4073.6553,1007.2932,16374.5986,2313.511,12235.5758,5370.0003,2936.4103,4907.7187,5729.8697,4216.7475,8625.6798,3225.6109],[0,0,0,722.2914,0,47.9067,3294.5545,640.9782,0,0,1596.1537,548.2192,539.3816,642.6018,0,974.4552],],[[6428.0821,4906.196,7035.6087,2228.5725,3536.9669,7883.7632,6299.9581,4665.9541,12429.119,18383.5502,20885.2504,7258.1395,795.2329,0,1574.8011,0],[3130.5996,4425.3182,4018.0485,3633.2282,7816.7485,12373.2708,31892.7965,7357.1357,11453.0675,8568.8618,10766.483,17077.8272,9700.6208,11658.9072,3663.1237,16312.9862],[10375.1909,9222.6119,22245.9308,11575.726,16406.8791,24914.2054,57110.6347,21395.1068,13535.3164,31998.5387,42921.0353,32122.1407,15865.3678,25030.4558,20390.9009,19023.0636],[1749.8997,3453.875,1353.0797,671.4824,226.9928,4510.9339,6846.53,1243.1477,512.4748,4094.3692,2125.1064,1738.7066,0,577.4595,0,0],[15513.618,8032.716,25625.5425,16069.0443,8630.7796,8142.2638,44579.5378,16850.1123,10562.1642,21147.4535,39771.3021,14147.634,4953.3741,9895.3475,13743.8153,7184.5934],[1218.7273,3250.3952,6243.0596,0,0,11915.2234,9138.0754,1886.3111,3419.7552,5770.106,13506.9644,2315.0593,0,2500.2363,2589.4036,0],],[[27404.4671,24125.656,18812.919,20948.3626,69626.5138,50928.2541,45082.588,61335.7476,56104.5995,34189.8652,27753.3936,43233.1987,67048.0586,63206.7359,23190.6686,65271.0966],[6063.9351,2702.5668,2626.5119,2991.1525,11228.5757,7121.5188,6117.5437,8828.9253,3665.3228,7945.8051,6898.4298,2309.1074,18879.2234,10551.3887,6718.3214,15129.0363],[5411.5485,4040.0131,6099.351,1886.2909,10159.6483,8012.8676,8757.2395,11000.3062,1775.1228,2320.9142,5636.286,5812.6028,17582.3229,7999.9687,3068.1492,9286.0281],[989.5448,873.4081,4711.0109,601.1695,4221.7005,5411.8698,17816.9386,5847.7853,2245.3158,642.9101,4885.8591,1695.0891,0,445.0833,1837.3489,0],[1597.9432,1006.1476,2644.1096,496.2421,2363.6187,485.5315,2507.5971,1246.6736,1197.5071,633.5708,1336.0623,1245.4034,0,0,558.4479,619.9476],[0,0,540.1364,0,0,0,1853.4977,0,0,427.0029,0,0,0,0,127.3735,0],],];
sig_data.dataset_sig_max = 223826.2268;
sig_data.route_id = ['AA','AC','AG','AT','CA','CC','CG','CT','GA','GC','GG','GT','TA','TC','TG','TT',];
sig_data.substitution = [{name: 'C > A', color: '#1BBDEB', route: ['ApCpA','ApCpC','ApCpG','ApCpT','CpCpA','CpCpC','CpCpG','CpCpT','GpCpA','GpCpC','GpCpG','GpCpT','TpCpA','TpCpC','TpCpG','TpCpT',],},{name: 'C > G', color: '#211D1E', route: ['ApCpA','ApCpC','ApCpG','ApCpT','CpCpA','CpCpC','CpCpG','CpCpT','GpCpA','GpCpC','GpCpG','GpCpT','TpCpA','TpCpC','TpCpG','TpCpT',],},{name: 'C > T', color: '#E62623', route: ['ApCpA','ApCpC','ApCpG','ApCpT','CpCpA','CpCpC','CpCpG','CpCpT','GpCpA','GpCpC','GpCpG','GpCpT','TpCpA','TpCpC','TpCpG','TpCpT',],},{name: 'T > A', color: '#CFCFCF', route: ['ApTpA','ApTpC','ApTpG','ApTpT','CpTpA','CpTpC','CpTpG','CpTpT','GpTpA','GpTpC','GpTpG','GpTpT','TpTpA','TpTpC','TpTpG','TpTpT',],},{name: 'T > C', color: '#ACD577', route: ['ApTpA','ApTpC','ApTpG','ApTpT','CpTpA','CpTpC','CpTpG','CpTpT','GpTpA','GpTpC','GpTpG','GpTpT','TpTpA','TpTpC','TpTpG','TpTpT',],},{name: 'T > G', color: '#EDC7C4', route: ['ApTpA','ApTpC','ApTpG','ApTpT','CpTpA','CpTpC','CpTpG','CpTpT','GpTpA','GpTpC','GpTpG','GpTpT','TpTpA','TpTpC','TpTpG','TpTpT',],},];
sig_data.Ids = ['TCGA-OR-A5J1','TCGA-OR-A5J2','TCGA-OR-A5J3','TCGA-OR-A5J4','TCGA-OR-A5J5','TCGA-OR-A5J6','TCGA-OR-A5J7','TCGA-OR-A5J8','TCGA-OR-A5J9','TCGA-OR-A5JA','TCGA-OR-A5JB','TCGA-OR-A5JC','TCGA-OR-A5JD','TCGA-OR-A5JE','TCGA-OR-A5JF','TCGA-OR-A5JG','TCGA-OR-A5JH','TCGA-OR-A5JI','TCGA-OR-A5JJ','TCGA-OR-A5JK','TCGA-OR-A5JL','TCGA-OR-A5JM','TCGA-OR-A5JO','TCGA-OR-A5JP','TCGA-OR-A5JQ','TCGA-OR-A5JR','TCGA-OR-A5JS','TCGA-OR-A5JT','TCGA-OR-A5JU','TCGA-OR-A5JV','TCGA-OR-A5JW','TCGA-OR-A5JX','TCGA-OR-A5JY','TCGA-OR-A5JZ','TCGA-OR-A5K0','TCGA-OR-A5K1','TCGA-OR-A5K2','TCGA-OR-A5K3','TCGA-OR-A5K4','TCGA-OR-A5K5','TCGA-OR-A5K6','TCGA-OR-A5K8','TCGA-OR-A5K9','TCGA-OR-A5KB','TCGA-OR-A5KO','TCGA-OR-A5KP','TCGA-OR-A5KQ','TCGA-OR-A5KS','TCGA-OR-A5KT','TCGA-OR-A5KU','TCGA-OR-A5KV','TCGA-OR-A5KW','TCGA-OR-A5KX','TCGA-OR-A5KY','TCGA-OR-A5KZ','TCGA-OR-A5L1','TCGA-OR-A5L2','TCGA-OR-A5L3','TCGA-OR-A5L4','TCGA-OR-A5L5','TCGA-OR-A5L6','TCGA-OR-A5L8','TCGA-OR-A5L9','TCGA-OR-A5LA','TCGA-OR-A5LB','TCGA-OR-A5LC','TCGA-OR-A5LD','TCGA-OR-A5LE','TCGA-OR-A5LF','TCGA-OR-A5LG','TCGA-OR-A5LH','TCGA-OR-A5LI','TCGA-OR-A5LJ','TCGA-OR-A5LK','TCGA-OR-A5LL','TCGA-OR-A5LN','TCGA-OR-A5LO','TCGA-OR-A5LP','TCGA-OR-A5LR','TCGA-OR-A5LS','TCGA-OR-A5LT','TCGA-OU-A5PI','TCGA-P6-A5OF','TCGA-P6-A5OH','TCGA-PA-A5YG','TCGA-PK-A5H8','TCGA-PK-A5H9','TCGA-PK-A5HA','TCGA-PK-A5HB','TCGA-PK-A5HC',];

// [ID, signature, value]
sig_data.mutations = [[0,0,0.421100],[0,1,0.240200],[0,2,0.029100],[0,3,0.309500],[1,0,0.186500],[1,1,0.638300],[1,2,0.175100],[1,3,0.000000],[2,0,0.160500],[2,1,0.700400],[2,2,0.139000],[2,3,0.000000],[3,0,0.054700],[3,1,0.424200],[3,2,0.235400],[3,3,0.285500],[4,0,1.000000],[4,1,0.000000],[4,2,0.000000],[4,3,0.000000],[5,0,0.119800],[5,1,0.880100],[5,2,0.000000],[5,3,0.000000],[6,0,0.200600],[6,1,0.499300],[6,2,0.145000],[6,3,0.154900],[7,0,0.043300],[7,1,0.472900],[7,2,0.424900],[7,3,0.058700],[8,0,0.162900],[8,1,0.696900],[8,2,0.070500],[8,3,0.069500],[9,0,0.013100],[9,1,0.000000],[9,2,0.986800],[9,3,0.000000],[10,0,0.021500],[10,1,0.361400],[10,2,0.541700],[10,3,0.075200],[11,0,0.050400],[11,1,0.863100],[11,2,0.086400],[11,3,0.000000],[12,0,0.123600],[12,1,0.625600],[12,2,0.055500],[12,3,0.195100],[13,0,0.092600],[13,1,0.647500],[13,2,0.119300],[13,3,0.140500],[14,0,0.026600],[14,1,0.705100],[14,2,0.091500],[14,3,0.176500],[15,0,0.054500],[15,1,0.899000],[15,2,0.046400],[15,3,0.000000],[16,0,0.000000],[16,1,0.810100],[16,2,0.189800],[16,3,0.000000],[17,0,0.127000],[17,1,0.671700],[17,2,0.000000],[17,3,0.201200],[18,0,0.129600],[18,1,0.731200],[18,2,0.000000],[18,3,0.139000],[19,0,0.124900],[19,1,0.717500],[19,2,0.037100],[19,3,0.120300],[20,0,0.113200],[20,1,0.886700],[20,2,0.000000],[20,3,0.000000],[21,0,0.083100],[21,1,0.796700],[21,2,0.105000],[21,3,0.015000],[22,0,0.008800],[22,1,0.896600],[22,2,0.094400],[22,3,0.000000],[23,0,0.089300],[23,1,0.704700],[23,2,0.145500],[23,3,0.060300],[24,0,0.153700],[24,1,0.740200],[24,2,0.059400],[24,3,0.046500],[25,0,0.119400],[25,1,0.822900],[25,2,0.000000],[25,3,0.057500],[26,0,0.081300],[26,1,0.891300],[26,2,0.027200],[26,3,0.000000],[27,0,0.070100],[27,1,0.708900],[27,2,0.149500],[27,3,0.071300],[28,0,0.087000],[28,1,0.787200],[28,2,0.072900],[28,3,0.052700],[29,0,0.140800],[29,1,0.689600],[29,2,0.169400],[29,3,0.000000],[30,0,0.115200],[30,1,0.593300],[30,2,0.102900],[30,3,0.188300],[31,0,0.176600],[31,1,0.671200],[31,2,0.049000],[31,3,0.103000],[32,0,0.134500],[32,1,0.540300],[32,2,0.161900],[32,3,0.163100],[33,0,0.087600],[33,1,0.912300],[33,2,0.000000],[33,3,0.000000],[34,0,0.049700],[34,1,0.703900],[34,2,0.155700],[34,3,0.090400],[35,0,0.069400],[35,1,0.813700],[35,2,0.048500],[35,3,0.068200],[36,0,0.058800],[36,1,0.730000],[36,2,0.099500],[36,3,0.111400],[37,0,0.112700],[37,1,0.786900],[37,2,0.034700],[37,3,0.065500],[38,0,0.891000],[38,1,0.108900],[38,2,0.000000],[38,3,0.000000],[39,0,0.075800],[39,1,0.560500],[39,2,0.133300],[39,3,0.230200],[40,0,0.053000],[40,1,0.765000],[40,2,0.126300],[40,3,0.055600],[41,0,0.082500],[41,1,0.746900],[41,2,0.086700],[41,3,0.083700],[42,0,0.105300],[42,1,0.632100],[42,2,0.112800],[42,3,0.149600],[43,0,0.000000],[43,1,0.115100],[43,2,0.770700],[43,3,0.114100],[44,0,0.172300],[44,1,0.673200],[44,2,0.154300],[44,3,0.000000],[45,0,0.138000],[45,1,0.726000],[45,2,0.094300],[45,3,0.041500],[46,0,0.144200],[46,1,0.772100],[46,2,0.045600],[46,3,0.037800],[47,0,0.145500],[47,1,0.803800],[47,2,0.000000],[47,3,0.050600],[48,0,0.101100],[48,1,0.760400],[48,2,0.120700],[48,3,0.017700],[49,0,0.216200],[49,1,0.639200],[49,2,0.086200],[49,3,0.058100],[50,0,0.090500],[50,1,0.702300],[50,2,0.095500],[50,3,0.111500],[51,0,0.054800],[51,1,0.804500],[51,2,0.140500],[51,3,0.000000],[52,0,0.295700],[52,1,0.458600],[52,2,0.000000],[52,3,0.245600],[53,0,0.069000],[53,1,0.818900],[53,2,0.112000],[53,3,0.000000],[54,0,0.060400],[54,1,0.748000],[54,2,0.140500],[54,3,0.050800],[55,0,0.077300],[55,1,0.714700],[55,2,0.111200],[55,3,0.096600],[56,0,0.171300],[56,1,0.459800],[56,2,0.179200],[56,3,0.189500],[57,0,0.176000],[57,1,0.693400],[57,2,0.000000],[57,3,0.130400],[58,0,0.055100],[58,1,0.699900],[58,2,0.244800],[58,3,0.000000],[59,0,0.091100],[59,1,0.828600],[59,2,0.065500],[59,3,0.014600],[60,0,0.118200],[60,1,0.784100],[60,2,0.091500],[60,3,0.006000],[61,0,0.242400],[61,1,0.594100],[61,2,0.000000],[61,3,0.163300],[62,0,0.060500],[62,1,0.820700],[62,2,0.076700],[62,3,0.041900],[63,0,0.315500],[63,1,0.492900],[63,2,0.093200],[63,3,0.098300],[64,0,0.687100],[64,1,0.161400],[64,2,0.085500],[64,3,0.065900],[65,0,0.186800],[65,1,0.605000],[65,2,0.192500],[65,3,0.015400],[66,0,0.118800],[66,1,0.526600],[66,2,0.017000],[66,3,0.337400],[67,0,0.124900],[67,1,0.868200],[67,2,0.000000],[67,3,0.006700],[68,0,0.027000],[68,1,0.972900],[68,2,0.000000],[68,3,0.000000],[69,0,0.018900],[69,1,0.913700],[69,2,0.067300],[69,3,0.000000],[70,0,0.108700],[70,1,0.654500],[70,2,0.065600],[70,3,0.170900],[71,0,0.042300],[71,1,0.933500],[71,2,0.024100],[71,3,0.000000],[72,0,0.798100],[72,1,0.133300],[72,2,0.038800],[72,3,0.029600],[73,0,0.160500],[73,1,0.710000],[73,2,0.129400],[73,3,0.000000],[74,0,0.181300],[74,1,0.480500],[74,2,0.112400],[74,3,0.225600],[75,0,0.093600],[75,1,0.822000],[75,2,0.084200],[75,3,0.000000],[76,0,0.065000],[76,1,0.682400],[76,2,0.191900],[76,3,0.060500],[77,0,0.204000],[77,1,0.605100],[77,2,0.065900],[77,3,0.124800],[78,0,0.152400],[78,1,0.687100],[78,2,0.007900],[78,3,0.152400],[79,0,0.000000],[79,1,0.878900],[79,2,0.057600],[79,3,0.063400],[80,0,0.151200],[80,1,0.678400],[80,2,0.140600],[80,3,0.029600],[81,0,0.116400],[81,1,0.665900],[81,2,0.108900],[81,3,0.108600],[82,0,0.104100],[82,1,0.666900],[82,2,0.135200],[82,3,0.093600],[83,0,0.103000],[83,1,0.541700],[83,2,0.108900],[83,3,0.246200],[84,0,0.249200],[84,1,0.289500],[84,2,0.153300],[84,3,0.307800],[85,0,0.110800],[85,1,0.554900],[85,2,0.169700],[85,3,0.164500],[86,0,0.015800],[86,1,0.830700],[86,2,0.060200],[86,3,0.093100],[87,0,0.187900],[87,1,0.616200],[87,2,0.131100],[87,3,0.064600],[88,0,0.176500],[88,1,0.569500],[88,2,0.004400],[88,3,0.249500],[89,0,0.010300],[89,1,0.736600],[89,2,0.202600],[89,3,0.050200],];

sig_data.esc_Ids = [];
for (var i=0; i < sig_data.Ids.length; i++) {
    sig_data.esc_Ids[i] = 'Key' + i;
}

function tooltip_text(format, obj) {
    var tooltip = [];
    for (var t in format.format) {
        tooltip.push(utils.text_format(format.format[t], obj));
    }
    return tooltip;
};

sig_data.get_data_par_signature = function (signature_id) {
    
    var tooltips = [];

    // par change
    for (var i=0; i < sig_data.substitution.length; i++) {
        
        var sum = 0;
        
        var obj = {
            'sig': sig_data.substitution[i].name,
        };
        tooltips[i] = [];
        segment_index = -1;
        for (var j=0; j < sig_data.dataset_sig[signature_id][i].length; j++) {
            if (j%16 == 0) {
                segment_index += 1;
                tooltips[i][segment_index] = [];
            }
            obj['route'] = sig_data.substitution[i].route[j];
            obj['#sum_item_value'] = sig_data.dataset_sig[signature_id][i][j];
            
            tooltips[i][segment_index].push(tooltip_text(sig_data.tooltip_format['signature_partial'], obj));
            sum += sig_data.dataset_sig[signature_id][i][j];
        }
        
        obj['#sum_group_value'] = sum;
        
        title = tooltip_text(sig_data.tooltip_format['signature_title'], obj);
        for (var s = 0; s < tooltips[i].length; s++) {
            for (var t = 0; t < title.length; t++) {
                tooltips[i][s].splice(t, 0, title[t]);
            }
        }
    }
    
    return {data: sig_data.dataset_sig[signature_id], tooltip: tooltips};
};

sig_data.get_bars_data = function () {
    
    var data = [];
    var keys = [];
    var tooltips = {};
    var sum_par_id = [];
    for (var i=0; i < sig_data.Ids.length; i++) {
        tooltips[sig_data.esc_Ids[i]] = [];
        sum_par_id[i] = 0;
    }
    
    // par func
    for (var f=0; f < sig_data.signatures.length; f++) {

        data[f] = [];
        keys[f] = [];

        // par ID
        for (var i=0; i < sig_data.Ids.length; i++) {
            
            var data_filt = sig_data.mutations.filter(function(item, index){
                if ((item[0] == i) && (item[1] == f)) return true;
            });
            
            //var sum = data_filt.length;
            var sum = 0;
            for (var s = 0; s < data_filt.length; s++) {
                sum += data_filt[s][2];
            }
            
            if (sum > 0) {
                data[f].push(sum);
                keys[f].push(sig_data.esc_Ids[i]);
                
                var obj = {
                    '#sum_mutaion_all': sig_data.mutations.length,
                    '#sum_item_value': sum,
                    'id': sig_data.Ids[i],
                    'sig': sig_data.signatures[f],
                };
                tooltips[sig_data.esc_Ids[i]].push(tooltip_text(sig_data.tooltip_format["mutation_partial"], obj));
                sum_par_id[i] += sum;
            }
        }
    }
    for (var i=0; i < sig_data.Ids.length; i++) {
        var obj = {
            '#sum_mutaion_all': sig_data.mutations.length,
            '#sum_item_value': sum_par_id[i],
            'id': sig_data.Ids[i],
        };
        
        title = tooltip_text(sig_data.tooltip_format["mutation_title"], obj);
        for (var t = 0; t < title.length; t++) {
            tooltips[sig_data.esc_Ids[i]].splice(t, 0, title[t]);
        }
    }
    
    return {data: data, key: keys, tooltip: tooltips};
};
})();
Object.freeze(sig_data);

